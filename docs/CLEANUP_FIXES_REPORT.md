# üõ†Ô∏è –û–¢–ß–ï–¢ –û–ë –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø–•: –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—á–∏—Å—Ç–∫–∏

## üìÖ –î–∞—Ç–∞: 8 –∏—é–ª—è 2025 –≥., 21:40

---

## üêõ –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –û–®–ò–ë–ö–ò

### ‚ùå –ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ callback'–∏ –æ—á–∏—Å—Ç–∫–∏ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π
**–ü—Ä–æ–±–ª–µ–º–∞:**
```
WARNING - –ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π callback: cleanup_30_days
WARNING - –ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π callback: cleanup_keep_5
WARNING - –ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π callback: cleanup_keep_10
WARNING - –ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π callback: cleanup_keep_3
```

**–†–µ—à–µ–Ω–∏–µ:**
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≤—Å–µ—Ö callback'–æ–≤ –¥–µ—Ç–∞–ª—å–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏ –≤ `button_handlers.py`
‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ `cleanup_backups_by_count()` –∏ `cleanup_backups_by_age()`
‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω `BackupManager` –Ω–æ–≤—ã–º–∏ –º–µ—Ç–æ–¥–∞–º–∏ –æ—á–∏—Å—Ç–∫–∏

---

## üÜï –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–û–°–¢–¨

### üßπ –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—á–∏—Å—Ç–∫–∏ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π

#### 1. –û—á–∏—Å—Ç–∫–∞ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É
- **`cleanup_keep_3`** - –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 –∫–æ–ø–∏–∏
- **`cleanup_keep_5`** - –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –∫–æ–ø–∏–π  
- **`cleanup_keep_10`** - –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –∫–æ–ø–∏–π

#### 2. –û—á–∏—Å—Ç–∫–∞ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É
- **`cleanup_30_days`** - —É–¥–∞–ª–∏—Ç—å –∫–æ–ø–∏–∏ —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π

#### 3. –ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã BackupManager
```python
def cleanup_old_backups_by_age(max_age_days: int) -> Dict[str, any]
def get_backup_statistics() -> Dict[str, any]
```

---

## üîß –†–ï–ê–õ–ò–ó–û–í–ê–ù–ù–´–ï –§–£–ù–ö–¶–ò–ò

### üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π
```python
stats = backup_manager.get_backup_statistics()
# –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
{
    "total_count": int,           # –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ø–∏–π
    "total_size": int,            # –û–±—â–∏–π —Ä–∞–∑–º–µ—Ä –≤ –±–∞–π—Ç–∞—Ö
    "total_size_mb": float,       # –û–±—â–∏–π —Ä–∞–∑–º–µ—Ä –≤ –ú–ë
    "oldest_backup": dict,        # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∞–º–æ–π —Å—Ç–∞—Ä–æ–π –∫–æ–ø–∏–∏
    "newest_backup": dict,        # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∞–º–æ–π –Ω–æ–≤–æ–π –∫–æ–ø–∏–∏
    "average_size": int,          # –°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä –∫–æ–ø–∏–∏
    "average_size_mb": float      # –°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä –≤ –ú–ë
}
```

### üóëÔ∏è –î–µ—Ç–∞–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞
```python
# –û—á–∏—Å—Ç–∫–∞ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É (–æ—Å—Ç–∞–≤–∏—Ç—å N –ø–æ—Å–ª–µ–¥–Ω–∏—Ö)
result = backup_manager.cleanup_old_backups(keep_count=5)

# –û—á–∏—Å—Ç–∫–∞ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É (—É–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—à–µ N –¥–Ω–µ–π)
result = backup_manager.cleanup_old_backups_by_age(max_age_days=30)

# –†–µ–∑—É–ª—å—Ç–∞—Ç:
{
    "deleted_count": int,         # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö –∫–æ–ø–∏–π
    "kept_count": int,            # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –∫–æ–ø–∏–π
    "freed_space": int,           # –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–Ω–æ–µ –º–µ—Å—Ç–æ –≤ –±–∞–π—Ç–∞—Ö
    "message": str,               # –û–ø–∏—Å–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    "cutoff_date": str            # –ì—Ä–∞–Ω–∏—á–Ω–∞—è –¥–∞—Ç–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É)
}
```

---

## üéõÔ∏è –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨–°–ö–ò–ô –ò–ù–¢–ï–†–§–ï–ô–°

### üñ±Ô∏è –ú–µ–Ω—é –æ—á–∏—Å—Ç–∫–∏ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π
–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –∫–æ–ø–∏–∏" –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç:

```
üßπ –û—á–∏—Å—Ç–∫–∞ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π

üìä –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:
‚Ä¢ –í—Å–µ–≥–æ –∫–æ–ø–∏–π: 3
‚Ä¢ –û–±—â–∏–π —Ä–∞–∑–º–µ—Ä: 0.2 –ú–ë  
‚Ä¢ –°–∞–º–∞—è —Å—Ç–∞—Ä–∞—è: 08.07.2025

–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∞–≤–∏–ª–æ –æ—á–∏—Å—Ç–∫–∏:
```

**–î–æ—Å—Ç—É–ø–Ω—ã–µ –æ–ø—Ü–∏–∏:**
- üóëÔ∏è –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10
- üóëÔ∏è –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5  
- üóëÔ∏è –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3
- üóëÔ∏è –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π
- ‚¨ÖÔ∏è –ù–∞–∑–∞–¥

### üìã –†–µ–∑—É–ª—å—Ç–∞—Ç –æ—á–∏—Å—Ç–∫–∏
–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏:

```
‚úÖ –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞

üóëÔ∏è –£–¥–∞–ª–µ–Ω–æ –∫–æ–ø–∏–π: 2
üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –∫–æ–ø–∏–π: 3
üíø –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–æ –º–µ—Å—Ç–∞: 0.12 –ú–ë

üìã –ü—Ä–∞–≤–∏–ª–æ: –°–æ—Ö—Ä–∞–Ω–µ–Ω—ã –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 –∫–æ–ø–∏–∏
```

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã
–°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç `test_extended_cleanup.py` –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

```bash
python test_extended_cleanup.py
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π
- ‚úÖ –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–æ–ø–∏–π —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
- ‚úÖ –û—á–∏—Å—Ç–∫–∞ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É (–Ω–µ—Ç –∫–æ–ø–∏–π –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è)
- ‚úÖ –û—á–∏—Å—Ç–∫–∞ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É (–Ω–µ—Ç –∫–æ–ø–∏–π —Å—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π)
- ‚úÖ –§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏

### üéØ –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ –∫–æ–ø–∏–π
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- ‚úÖ –û—á–∏—Å—Ç–∫–∞ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É
- ‚úÖ –û—á–∏—Å—Ç–∫–∞ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ edge cases (–Ω–µ—Ç –∫–æ–ø–∏–π –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è)

---

## üîç –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –î–ï–¢–ê–õ–ò

### 1. –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ callback'–æ–≤
**–í `button_handlers.py` –¥–æ–±–∞–≤–ª–µ–Ω—ã:**
```python
elif data == "cleanup_30_days":
    await cleanup_backups_by_age(update, context, 30)
elif data == "cleanup_keep_3":
    await cleanup_backups_by_count(update, context, 3)
elif data == "cleanup_keep_5":
    await cleanup_backups_by_count(update, context, 5)
elif data == "cleanup_keep_10":
    await cleanup_backups_by_count(update, context, 10)
```

### 2. –§—É–Ω–∫—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
**–î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ async —Ñ—É–Ω–∫—Ü–∏–∏:**
- `cleanup_backups_by_count(update, context, keep_count)`
- `cleanup_backups_by_age(update, context, max_age_days)`

### 3. –ú–µ—Ç–æ–¥—ã BackupManager
**–†–∞—Å—à–∏—Ä–µ–Ω –∫–ª–∞—Å—Å BackupManager:**
- `cleanup_old_backups_by_age(max_age_days)` - –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥
- `get_backup_statistics()` - –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π —Å–ª–æ–≤–∞—Ä—å –≤ `cleanup_old_backups()` (–¥–æ–±–∞–≤–ª–µ–Ω `freed_space`)

---

## üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ò–ó–ú–ï–ù–ï–ù–ò–ô

### üìÅ –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- ‚úèÔ∏è `src/bot/handlers/button_handlers.py` (+120 —Å—Ç—Ä–æ–∫)
- ‚úèÔ∏è `src/utils/backup_manager.py` (+80 —Å—Ç—Ä–æ–∫)
- üÜï `test_extended_cleanup.py` (78 —Å—Ç—Ä–æ–∫)

### üíª –û–±—ä–µ–º —Ä–∞–±–æ—Ç—ã
- **–ù–æ–≤—ã–π –∫–æ–¥**: ~200 —Å—Ç—Ä–æ–∫
- **–ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**: 4
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ callback'–∏**: 4
- **–í—Ä–µ–º—è –Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é**: ~30 –º–∏–Ω—É—Ç

---

## ‚úÖ –†–ï–ó–£–õ–¨–¢–ê–¢

### üéØ –í—Å–µ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
- ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ callback'–∏** - –±–æ–ª—å—à–µ –Ω–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π
- ‚úÖ **–†–∞—Å—à–∏—Ä–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –æ—á–∏—Å—Ç–∫–∏** - –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–µ—Ç–∞–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏
- ‚úÖ **–£–ª—É—á—à–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç** - –ø–æ–Ω—è—Ç–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å –≤—ã–±–æ—Ä–æ–º
- ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–ø–∏—è—Ö
- ‚úÖ **–ü—Ä–æ–≤–µ–¥–µ–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### üöÄ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—á–∏—Å—Ç–∫–∏ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏!

---

**üìù –û—Ç—á–µ—Ç —Å–æ—Å—Ç–∞–≤–ª–µ–Ω**: 8 –∏—é–ª—è 2025 –≥., 21:40  
**üîß –í–µ—Ä—Å–∏—è**: 2.1.1  
**üìä –°—Ç–∞—Ç—É—Å**: ‚úÖ **–í–°–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –ó–ê–í–ï–†–®–ï–ù–´**
