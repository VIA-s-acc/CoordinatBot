# –û—Ç—á–µ—Ç –æ –º–∏–≥—Ä–∞—Ü–∏–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

## –ü–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∏–∑ —Å—Ç–∞—Ä–æ–≥–æ `main.py` –≤ –Ω–æ–≤—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É:

### ‚úÖ –£–∂–µ –±—ã–ª–æ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ:
1. **–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã**: `/start`, `/menu`, `/help`
2. **–ö–æ–º–∞–Ω–¥—ã –ø–æ–∏—Å–∫–∞**: `/search`, `/recent`, `/info`, `/my_report`
3. **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã**: `/set_log`, `/set_sheet`, `/set_report`, `/allow_user`, `/disallow_user`, `/allowed_users`, `/set_user_name`, `/export`, `/sync_sheets`, `/initialize_sheets`
4. **–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∑–∞–ø–∏—Å–µ–π**: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π
5. **–†–∞–±–æ—Ç–∞ —Å Google Sheets**: —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è, –≤—ã–±–æ—Ä —Ç–∞–±–ª–∏—Ü –∏ –ª–∏—Å—Ç–æ–≤
6. **–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏**: –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### ‚úÖ –ù–µ–¥–∞–≤–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ:
1. **–°–∏—Å—Ç–µ–º–∞ –ø–ª–∞—Ç–µ–∂–µ–π**: 
   - `pay_menu_handler` - –º–µ–Ω—é –≤—ã–±–æ—Ä–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
   - `pay_user_handler` - –º–µ–Ω—é –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
   - `start_add_payment` - –Ω–∞—á–∞–ª–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞
   - `get_payment_amount` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—É–º–º—ã –ø–ª–∞—Ç–µ–∂–∞
   - `get_payment_period` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–∞ –ø–ª–∞—Ç–µ–∂–∞
   - `get_payment_comment` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –∫ –ø–ª–∞—Ç–µ–∂—É
   - `send_payment_report` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è Excel –æ—Ç—á–µ—Ç–æ–≤ –ø–æ –ø–ª–∞—Ç–µ–∂–∞–º

2. **–£—Ç–∏–ª–∏—Ç—ã –ø–ª–∞—Ç–µ–∂–µ–π** (`src/utils/payment_utils.py`):
   - `normalize_date` - –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞—Ç
   - `merge_payment_intervals` - –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤ –ø–ª–∞—Ç–µ–∂–µ–π
   - `format_date_for_interval` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç –¥–ª—è –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤
   - `get_user_id_by_display_name` - –ø–æ–∏—Å–∫ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–º—É –∏–º–µ–Ω–∏
   - `send_message_to_user` - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º

3. **ConversationHandler –¥–ª—è –ø–ª–∞—Ç–µ–∂–µ–π**: 
   - –°–æ—Å—Ç–æ—è–Ω–∏—è: `PAYMENT_AMOUNT`, `PAYMENT_PERIOD`, `PAYMENT_COMMENT`
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞

4. **–ö–Ω–æ–ø–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π**: 
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "üí∏ ’é’≥’°÷Ä’∂’•÷Ä" –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
   - –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ `pay_menu`, `pay_user_*`, `add_payment_*`, `get_payment_report_*`

5. **–§—É–Ω–∫—Ü–∏—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞—Ç**: –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `src/utils/date_utils.py`

### üìä –ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:
- –¢–∞–±–ª–∏—Ü–∞ `payments` —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- –§—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å –ø–ª–∞—Ç–µ–∂–∞–º–∏: `add_payment`, `get_payments` —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã

### üîß –§–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã:
- `src/utils/payment_utils.py` - —Å–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π —Ñ–∞–π–ª —Å —É—Ç–∏–ª–∏—Ç–∞–º–∏ –ø–ª–∞—Ç–µ–∂–µ–π
- `src/bot/handlers/payment_handlers.py` - –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω –¥–ª—è –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- `src/bot/handlers/conversation_handlers.py` - –¥–æ–±–∞–≤–ª–µ–Ω ConversationHandler –¥–ª—è –ø–ª–∞—Ç–µ–∂–µ–π
- `src/bot/states/conversation_states.py` - –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –ø–ª–∞—Ç–µ–∂–µ–π
- `src/bot/handlers/button_handlers.py` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ –ø–ª–∞—Ç–µ–∂–µ–π
- `src/utils/date_utils.py` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è normalize_date

### üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–∏:
–í—Å—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∏–∑ —Å—Ç–∞—Ä–æ–≥–æ —Ñ–∞–π–ª–∞ `main.py` –±—ã–ª–∞ —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –≤ –Ω–æ–≤—É—é –º–æ–¥—É–ª—å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É. –°–∏—Å—Ç–µ–º–∞ –ø–ª–∞—Ç–µ–∂–µ–π —Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ —Å:

1. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π**: —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã –º–æ–≥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ø–ª–∞—Ç–µ–∂–∞–º–∏
2. **–ë–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö**: –ø–ª–∞—Ç–µ–∂–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É `payments`
3. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏**: –ø–æ–ª—É—á–∞—Ç–µ–ª–∏ –ø–ª–∞—Ç–µ–∂–µ–π –ø–æ–ª—É—á–∞—é—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º**: –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è —Å –ø–ª–∞—Ç–µ–∂–∞–º–∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –ª–æ–≥-—á–∞—Ç
5. **Excel –æ—Ç—á–µ—Ç–∞–º–∏**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤

### üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –∑–∞–ø—É—Å–∫—É:
–ë–æ—Ç —Å –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π –≥–æ—Ç–æ–≤ –∫ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç–µ –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏ + —É–ª—É—á—à–µ–Ω–Ω—É—é –º–æ–¥—É–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è easier maintenance.

## –ö–ª—é—á–µ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
1. **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å**: –∫–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ñ–∞–π–ª–µ
2. **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å**: —á–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
3. **Maintainability**: –ø—Ä–æ—â–µ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
4. **Error handling**: —É–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
5. **Type hints**: –¥–æ–±–∞–≤–ª–µ–Ω—ã –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ —Ç–∏–ø–æ–≤ –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ
