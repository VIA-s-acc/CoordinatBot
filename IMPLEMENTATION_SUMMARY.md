# Резюме реализации автоматической отправки файлов

## Что было реализовано

### 1. Модуль периодических задач
- **Файл**: `src/utils/periodic_tasks.py`
- **Функциональность**: Автоматическая отправка файлов данных каждые N часов
- **Подход**: Использование отдельного потока (threading) для стабильной работы

### 2. Настройки конфигурации
- **Файл**: `src/config/settings.py`
- Добавлены параметры:
  - `AUTO_SEND_DATA_INTERVAL_HOURS` - интервал отправки (по умолчанию 24 часа)
  - `AUTO_SEND_DATA_ADMIN_ID` - ID администратора (714158870)

### 3. Новые команды администратора
- **Файл**: `src/bot/handlers/admin_handlers.py`
- `/set_auto_send_interval [часы]` - настройка интервала
- `/manual_send_data` - ручная отправка файлов

### 4. Интеграция в основное приложение
- **Файл**: `src/main.py`
- Автоматический запуск периодических задач при старте бота
- Корректная остановка при завершении

## Как это работает

1. **При запуске бота** запускается отдельный поток для периодических задач
2. **Через 5 минут** после запуска - первая автоматическая отправка файлов
3. **Каждые N часов** - повторная отправка всех файлов из папки `data/`
4. **При остановке бота** - корректное завершение потока

## Отправляемые файлы

Все файлы из папки `data/`:
- `users.json`
- `allowed_users.json`
- `bot_config.json`
- `expenses.db`
- `bot.log`

## Настройка интервала

### Через переменную окружения
В файле `.env`:
```bash
AUTO_SEND_DATA_INTERVAL_HOURS=24
```

### Через команду бота
```
/set_auto_send_interval 12  # Каждые 12 часов
```

## Установка зависимостей

Для запуска бота необходимо установить зависимости:

```bash
# Активируйте виртуальное окружение
cd d:\GIT\CoordinatBot
python -m venv venv
venv\Scripts\activate

# Установите зависимости
pip install -r requirements.txt

# Запустите бота
python -m src.main
```

## Логирование

Все события периодических задач записываются в лог:
- `Starting periodic worker thread` - Запуск потока
- `Sending initial data files on startup` - Первая отправка
- `Periodic data files sent to admin` - Успешная отправка
- Ошибки также логируются

## Безопасность

- ID получателя жестко задан: `714158870`
- Отправка только администраторам
- При ошибках бот продолжает работу

## Статус реализации

✅ **Завершено**:
- Модуль периодических задач
- Настройки конфигурации  
- Команды администратора
- Интеграция в main.py
- Документация

⚠️ **Требует тестирования**:
- Запуск с установленными зависимостями
- Проверка отправки файлов
- Тестирование команд настройки
